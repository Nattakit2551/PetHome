<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>PetHome - My Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    body {
        background: linear-gradient(135deg,#F3E5C7,#E1C699,#CFAE70);
        background-attachment: fixed;
        font-family: 'Kanit', sans-serif;
        margin: 0;
        padding: 40px 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .main-wrapper {
        display: flex;
        gap: 30px;
        width: 100%;
        max-width: 1100px;
        padding: 0 20px;
    }

    /* --- Profile Card --- */
    .profile-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 30px;
        padding: 40px 30px;
        width: 340px;
        text-align: center;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        height: fit-content;
        position: sticky;
        top: 20px;
    }

    .profile-img-container {
        position: relative;
        width: 140px;
        height: 140px;
        margin: 0 auto 20px;
        cursor: pointer;
    }

    .profile-img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid #fff;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        transition: 0.3s;
    }

    .img-overlay {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        opacity: 0;
        transition: 0.3s;
        font-size: 24px;
        border: 5px solid transparent;
    }

    .profile-img-container:hover .img-overlay { opacity: 1; }

    #fileInput { display: none; }

    .user-name { font-size: 24px; font-weight: bold; color: #5d4037; margin-bottom: 5px; }
    .user-handle { font-size: 16px; color: #888; margin-bottom: 15px; }
    
    .contact-info {
        font-size: 14px; color: #666; margin-bottom: 10px;
        display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .contact-info i { color: #8d6e63; width: 20px; text-align: center; }

    /* Edit Mode */
    .edit-input {
        display: none; width: 80%; padding: 5px; margin: 5px auto;
        border: 1px solid #ccc; border-radius: 5px; font-family: 'Kanit', sans-serif; text-align: center;
    }

    .btn-edit { background: #ffb74d; color: white; padding: 8px 15px; border-radius: 20px; border: none; cursor: pointer; font-size: 12px; margin-bottom: 20px; }
    .btn-save { background: #66bb6a; color: white; padding: 8px 15px; border-radius: 20px; border: none; cursor: pointer; font-size: 12px; margin-bottom: 20px; display: none; }

    .btn-logout {
        width: 100%; padding: 12px; border-radius: 50px; border: none;
        background: #ffebee; color: #e53935; font-weight: bold; cursor: pointer;
        transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px;
    }
    .btn-logout:hover { background: #ffcdd2; }

    .btn-back {
        width: 100%; padding: 12px; border-radius: 50px; border: none;
        background: #5d4037; color: white; font-weight: bold; cursor: pointer;
        transition: 0.3s; margin-top: 15px; text-decoration: none; display: inline-block; box-sizing: border-box; text-align: center;
    }
    .btn-back:hover { background: #3e2723; }

    /* Content Area */
    .content-area {
        flex: 1; background: rgba(255, 255, 255, 0.9); border-radius: 30px;
        padding: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .section-title {
        font-size: 22px; font-weight: bold; color: #5d4037; margin-bottom: 25px;
        display: flex; align-items: center; gap: 10px; border-bottom: 2px solid #f3e5c7; padding-bottom: 15px;
    }

    .order-table { width: 100%; border-collapse: collapse; }
    .order-table th { text-align: left; color: #8d6e63; padding: 15px; border-bottom: 2px solid #eee; }
    .order-table td { padding: 15px; border-bottom: 1px solid #f9f9f9; color: #555; vertical-align: middle; }
    .order-row:hover { background: #fffaf0; }

    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; }
    .status-pending { background: #fff3e0; color: #f57c00; }
    .status-success { background: #e8f5e9; color: #2e7d32; }
    .status-cancel { background: #ffebee; color: #c62828; } /* สีแดงสำหรับสถานะยกเลิก */
    
    .empty-orders { text-align: center; padding: 50px; color: #aaa; }

    @media (max-width: 768px) {
        .main-wrapper { flex-direction: column; }
        .profile-card { width: 100%; position: static; }
        .order-table { display: block; overflow-x: auto; }
    }
</style>
</head>
<body>

<div class="main-wrapper">
    <div class="profile-card">
        <div class="profile-img-container" onclick="document.getElementById('fileInput').click()">
            <img src="https://via.placeholder.com/150" id="profile-pic" class="profile-img">
            <div class="img-overlay"><i class="fas fa-camera"></i></div>
        </div>
        <input type="file" id="fileInput" accept="image/*" onchange="changeProfileImage(this)">

        <div class="user-name">
            <span id="disp-name">User Name</span>
            <input type="text" id="edit-name" class="edit-input" placeholder="ชื่อ-นามสกุล">
        </div>
        <div class="contact-info" style="color:#888;">
            <i class="fas fa-user-tag"></i> <span id="disp-nick">ชื่อเล่น</span>
            <input type="text" id="edit-nick" class="edit-input" placeholder="ชื่อเล่น">
        </div>
        <div class="user-handle" id="disp-user">@username</div>
        <div class="contact-info">
            <i class="fas fa-envelope"></i> <span id="disp-email">email@example.com</span>
            <input type="email" id="edit-email" class="edit-input" placeholder="อีเมล">
        </div>
        <div class="contact-info">
            <i class="fas fa-phone"></i> <span id="disp-phone">081-234-5678</span>
            <input type="tel" id="edit-phone" class="edit-input" placeholder="เบอร์โทร">
        </div>

        <button id="btn-edit-mode" class="btn-edit" onclick="toggleEditMode()"><i class="fas fa-edit"></i> แก้ไขโปรไฟล์</button>
        <button id="btn-save-mode" class="btn-save" onclick="saveProfile()"><i class="fas fa-save"></i> บันทึกข้อมูล</button>

        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
        <button onclick="logout()" class="btn-logout"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</button>
        <a href="index.html" class="btn-back">⬅ กลับหน้าแรก</a>
    </div>

    <div class="content-area">
        <div class="section-title">
            <i class="fas fa-history"></i> ประวัติการสั่งซื้อ
        </div>

        <table class="order-table">
            <thead>
                <tr>
                    <th>หมายเลขคำสั่งซื้อ</th>
                    <th>วันที่</th>
                    <th>รายการสินค้า</th>
                    <th>ยอดรวม</th>
                    <th>สถานะ</th>
                </tr>
            </thead>
            <tbody id="order-history-body"></tbody>
        </table>
    </div>
</div>

<script>
    if (localStorage.getItem("isLoggedIn") !== "true") {
         // window.location.href = "Login.html"; 
    }

    // --- โหลดข้อมูลผู้ใช้ ---
    function loadUserData() {
        const savedName = localStorage.getItem("storedName") || "คุณลูกค้าที่รัก";
        const savedNick = localStorage.getItem("storedNick") || "ไม่ได้ระบุ";
        const savedUser = localStorage.getItem("storedUser") || "member01";
        const savedEmail = localStorage.getItem("storedEmail") || "user@example.com";
        const savedPhone = localStorage.getItem("storedPhone") || "ไม่ได้ระบุ";

        document.getElementById('disp-name').innerText = savedName;
        document.getElementById('disp-nick').innerText = savedNick;
        document.getElementById('disp-user').innerText = "@" + savedUser;
        document.getElementById('disp-email').innerText = savedEmail;
        document.getElementById('disp-phone').innerText = savedPhone;

        document.getElementById('edit-name').value = savedName;
        document.getElementById('edit-nick').value = savedNick;
        document.getElementById('edit-email').value = savedEmail;
        document.getElementById('edit-phone').value = savedPhone;

        const storedImg = localStorage.getItem("petProfilePic");
        if(storedImg) document.getElementById('profile-pic').src = storedImg;
    }

    loadUserData();

    // --- ฟังก์ชันแก้ไขโปรไฟล์ ---
    function toggleEditMode() {
        document.getElementById('disp-name').style.display = 'none';
        document.getElementById('disp-nick').style.display = 'none';
        document.getElementById('disp-email').style.display = 'none';
        document.getElementById('disp-phone').style.display = 'none';

        document.getElementById('edit-name').style.display = 'block';
        document.getElementById('edit-nick').style.display = 'block';
        document.getElementById('edit-email').style.display = 'block';
        document.getElementById('edit-phone').style.display = 'block';

        document.getElementById('btn-edit-mode').style.display = 'none';
        document.getElementById('btn-save-mode').style.display = 'inline-block';
    }

    function saveProfile() {
        const newName = document.getElementById('edit-name').value;
        const newNick = document.getElementById('edit-nick').value;
        const newEmail = document.getElementById('edit-email').value;
        const newPhone = document.getElementById('edit-phone').value;

        localStorage.setItem("storedName", newName);
        localStorage.setItem("storedNick", newNick);
        localStorage.setItem("storedEmail", newEmail);
        localStorage.setItem("storedPhone", newPhone);

        loadUserData();

        document.getElementById('edit-name').style.display = 'none';
        document.getElementById('edit-nick').style.display = 'none';
        document.getElementById('edit-email').style.display = 'none';
        document.getElementById('edit-phone').style.display = 'none';

        document.getElementById('disp-name').style.display = 'inline';
        document.getElementById('disp-nick').style.display = 'inline';
        document.getElementById('disp-email').style.display = 'inline';
        document.getElementById('disp-phone').style.display = 'inline';

        document.getElementById('btn-edit-mode').style.display = 'inline-block';
        document.getElementById('btn-save-mode').style.display = 'none';
    }

    function changeProfileImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('profile-pic').src = e.target.result;
                try { localStorage.setItem("petProfilePic", e.target.result); } catch(err) {}
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // --- ฟังก์ชันแสดงประวัติ (เอาปุ่มยกเลิกออกแล้ว) ---
    function loadOrderHistory() {
        const history = JSON.parse(localStorage.getItem("petOrderHistory")) || [];
        const tbody = document.getElementById("order-history-body");

        if(history.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="empty-orders">
                        <i class="fas fa-box-open" style="font-size:40px; margin-bottom:10px;"></i><br>
                        ยังไม่มีประวัติการสั่งซื้อ
                    </td>
                </tr>
            `;
            return;
        }

        tbody.innerHTML = history.map(order => {
            let badgeClass = '';
            
            // เช็คสถานะเพื่อเปลี่ยนสี
            if (order.status === 'ยกเลิก') {
                badgeClass = 'status-cancel';
            } else if (order.status === 'รอตรวจสอบ') {
                badgeClass = 'status-pending';
            } else {
                badgeClass = 'status-success';
            }

            return `
                <tr class="order-row">
                    <td style="font-weight:bold; color:#5d4037;">#${order.id}</td>
                    <td>${order.date}</td>
                    <td style="max-width:200px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                        ${order.items}
                    </td>
                    <td style="font-weight:bold;">฿ ${order.total}</td>
                    <td><span class="status-badge ${badgeClass}">${order.status}</span></td>
                </tr>
            `;
        }).join("");
    }

    function logout() {
        if(confirm("ต้องการออกจากระบบใช่หรือไม่?")) {
            localStorage.removeItem("isLoggedIn");
            window.location.href = "Login.html"; 
        }
    }

    loadOrderHistory();
</script>

</body>
</html>